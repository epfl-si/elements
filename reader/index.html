<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Styleguide</title>
  <script src="https://cdn.polyfill.io/v2/polyfill.js?features=String.prototype.includes,Array.prototype.includes,Array.prototype.find,CustomEvent"></script>

  <!-- Favicons -->
  <link rel="icon" type="image/png" sizes="228x228" href="./favicons/favicon-228.png">
  <link rel="icon" type="image/png" sizes="180x180" href="./favicons/favicon-180.png">
  <link rel="icon" type="image/png" sizes="152x152" href="./favicons/favicon-152.png">
  <link rel="icon" type="image/png" sizes="144x144" href="./favicons/favicon-144.png">
  <link rel="icon" type="image/png" sizes="128x128" href="./favicons/favicon-128.png">
  <link rel="icon" type="image/png" sizes="120x120" href="./favicons/favicon-120.png">
  <link rel="icon" type="image/png" sizes="96x96" href="./favicons/favicon-96.png">
  <link rel="icon" type="image/png" sizes="76x76" href="./favicons/favicon-76.png">
  <link rel="icon" type="image/png" sizes="57x57" href="./favicons/favicon-57.png">
  <link rel="icon" type="image/png" sizes="32x32" href="./favicons/favicon-32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="./favicons/favicon-16.png">
  <link rel="apple-touch-icon" sizes="180x180" href="./favicons/apple-touch-icon.png">
  <link rel="manifest" href="./favicons/site.webmanifest">
  <link rel="mask-icon" href="./favicons/safari-pinned-tab.svg" color="#5bbad5">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="theme-color" content="#e30713">
  <!-- end favicons -->

  <link rel="stylesheet" href="css/vendors.min.css">
  <link rel="stylesheet" href="css/elements.css">
  <link rel="stylesheet" href="css/reader.css">

  <script>

   // Compile-time constants on the global `window` object

   window.sourcesOrder = ['atoms', 'molecules', 'organisms', 'content-types', 'pages'];

   // <% print("\n\n");

   const walkSync = require('walk-sync')

   const { version }  = require('../package.json')
   const colors       = require('../assets/config/colors.json')
   const docs         = require('../docs/summary.yml')
   const theme        = require('../toolbox.json').theme
   const data_        = require('../assets/config/data.json')

   const windowProperties = { version, colors, docs, theme, data: data_ }

   windowProperties.sources = {}   // Historical bad name
   const parseYamlPath = new RegExp('^([^/]+)/([^/]+)/([^/]+)\.yml$')
   for (let path of walkSync('./assets/components')) {
     let matched = path.match(parseYamlPath)
     if (! matched) continue
     let [_unused, taxon, component, componentAgain] = matched
     if (component !== componentAgain) continue

     if (! windowProperties.sources[taxon]) {
       windowProperties.sources[taxon] = []
     }
     const sources = windowProperties.sources[taxon]

     const newSource =
       // Webpack parses the variadic require() on the line below, and
       // figures out that it must bundle all .yml files under
       // ../assets/components! Very nice, but... fragile. Don't break
       // it in refactoring; unparsed require() is left as-is during
       // transpilation, and thus ends up calling the node.js core
       // implementation at runtime (for YAML files, with an outcome
       // about as bad as you'd expect).
       require("../assets/components/" + [taxon, component, componentAgain].join("/") + ".yml")

     newSource.id = sources.length
     newSource.type = taxon
     newSource.markup = "components/" + path.replace(/\.yml$/, ".twig")
     if (! newSource.variants) {
       newSource.variants = []
     }

     sources.push(newSource)
   }

   for (const p in windowProperties) {
     const v = windowProperties[p]
     print(`window.${p} = ${JSON.stringify(v, null, 4)};\n`)
   }

   // %>
  </script>

  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="js/vendors.min.js"></script>
  <script src="js/elements.bundle.js"></script>
  <script src="js/reader.bundle.js"></script>
</head>

<body data-spy="scroll" data-target="#intermediate-nav" data-offset="0">
  <div id="styleguide"></div>
</body>

</html>
